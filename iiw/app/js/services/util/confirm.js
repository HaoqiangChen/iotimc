define(["angular","css!../../../css/iconfirm"],function(i){i.factory("iConfirm",["$compile",function(i){function n(n){var o=$.extend({},l,n);o.close&&$.each(o.buttons,function(i,n){if(n&&n.action&&n.action==o.close)throw"close和button action不能为同一个方法，否则将会导致死循环！"}),o.id=a++,s.append(e(o));var t=$(window),f=t.width(),u=t.height(),d=s.find("#iiw-confirm-"+o.id),v=d.get(0),w=d.find(".iiw-confirm-box"),m=d.find(".iiw-confirm-box .iiw-confirm-box-buttons button");if(o.templateUrl){var b=d.find(".iiw-confirm-box .iiw-confirm-box-content");b.html(c(o.templateUrl))}if(v&&o.close&&(v.close=function(){return o.scope.$eval(o.close+"("+o.id+")")}),d.click(function(){r($(this))}),w.click(function(i){i.stopPropagation()}),o.scope){$.each(o.buttons,function(i,n){var t=m.get(i);t&&$(t).click(function(){o.scope.$eval(n.action+"("+o.id+")")})});var p=o.scope.$new();$(v).data("newScope",p),i(v)(p)}return d.width(f).height(u).show("fade"),o.id}function o(i){var n=s.find("#iiw-confirm-"+i);n.size()&&r(n)}function t(i){return s.find("#iiw-confirm-"+i)}function c(i){var n="";return $.ajax({url:i,async:!1,cache:!1,dataType:"text"}).success(function(i){n=i}),n}function e(i){function n(i){var n=[];return $.each(i.buttons,function(i,o){n.push('<button class="button button-glow button-rounded '+o.style+'">'),n.push(o.text),n.push("</button>")}),n.join("")}var o=['<div id="iiw-confirm-'+i.id+'" class="iiw-confirm-dialog">','<div class="iiw-confirm-bg">','<div class="iiw-confirm-row">','<div class="iiw-confirm-box">','<div class="iiw-confirm-box-title">',"<h1>"+i.title+"</h1>","</div>",'<div class="iiw-confirm-box-content">',"<p>"+i.content+"</p>","</div>",'<div class="iiw-confirm-box-buttons">',n(i),"</div>","</div>","</div>","</div>","</div>"];return o.join("")}function r(i){function n(){i.hide("fade",function(){var n=i.data("newScope");n&&n.$destroy(),i.remove()})}var o=i.get(0);o&&o.close?o.close()&&n():n()}var s,a=0,l={id:null,title:null,content:null,templateUrl:null,scope:null,buttons:[],close:null};return $("body").append('<div class="iiw-confirm"></div>'),s=$(".iiw-confirm"),{show:n,close:o,getEl:t}}])});