define(["angular","directives/message/messagepanel"],function(e){e.factory("iMessage",["$rootScope","$compile","$interpolate","$filter","$interval","iTimeNow",function(e,t,i,n,s,o){function a(e,t,i){r(),u.list.length>9&&(u.list=u.list.slice(u.list.length-9)),e.level=e.level||"2",e.now=o.now,e.time=e.time||n("date")(o.now,"yyyy-MM-dd HH:mm:ss"),e.timeout=e.timeout||5e3,e.content=e.content||"",e.drag=e.drag||!1,u.list.push({id:e.id||"",json:e,call:t,scope:i,cs:c(e),isDrag:!1}),$.each(u.list,function(e,t){t.style?t.isDrag||(t.style.top+=190):(t.style={right:0,top:90},t.bgStyle={opacity:t.json.opacity||1})})}function c(e){var t="";switch(e.level){case 1:case"1":t={bgc:"success",icon:"fa fa-check"};break;case 2:case"2":t={bgc:"info",icon:"fa fa-info"};break;case 3:case"3":t={bgc:"warning",icon:"fa fa-exclamation-triangle"};break;case 4:case"4":t={bgc:"danger",icon:"fa fa-times"}}return t}function l(){$.each(u.list,function(e,t){"0"!=t.json.timeout&&t.json.now+t.json.timeout<o.now&&(t.istimeout=!0)})}function r(){var e=_.where(u.list,{istimeout:!0});u.list=_.difference(u.list,e)}var f="",g=!1,u=e.$new();return u.list=[],$("body").append("<i-message-panel></i-message-panel>"),t($("i-message-panel"))(u),s(l,1e3),{show:function(e,t,i,n){g||(t?f!=e.content&&(a(e,i,n),f=e.content):a(e,i,n))},remove:function(e){if(e){var t=_.findWhere(u.list,{id:e});t&&(u.list=_.difference(u.list,[t]))}},setNoLog:function(e){g=e}}}])});