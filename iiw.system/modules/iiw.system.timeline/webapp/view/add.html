<div class="layout-full iiw-system-timeline">
    <div class="ui-layout-row add" ui-layout="{ flow: 'row'}" options="{dividerSize:'0'}">
        <div class="ui-layout-container iiw-system-form-container" style="padding: 0" ui-layout-container >
            <div ng-show="selectOUname" id="OUnameFrame">
                <div class="col-lg-12">
                    <div class="col-lg-12">
                        <div ng-repeat="rows in syouList" class="col-lg-3 col-md-4 col-sm-6">
                            <div class="col-xs-12" id="orange" ng-click="chooseOu(rows, $index, rows.id)" ng-class="{'orange': rows.checked}">
                                <p>{{rows.name}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 text-right" ng-style="{'height': '45px'}">
                        <div>
                            <p ng-click="chooseAll()" ng-class="{'orange': timeLine.chooseAllBtn}">全选</p>
                            <p ng-click="oppositeChoose()">反选</p>
                        </div>
                        <button class="btn btn-success" ng-click="confirmChoose()">确定</button>
                        <button class="btn btn-danger" ng-click="cancelOUname()">关闭</button>
                    </div>
                </div>
            </div>
            <div class="add-time-line">
                <form style="" class="form-horizontal label-left" id="entityItemForm" name="entityItemForm" novalidate>
                    <div class="control-group row ouname" ng-style="{'padding-top': '30px'}">
                        <div class="col-md-2">
                            <label ng-class="{'color-red': ouname == '请选择单位！'}" class="control-label">所属单位</label>
                        </div>

                        <div ng-class="{'border-red': ouname == '请选择单位！'}" class="col-md-8 title" ng-click="confirmChoose()">
                            <span ng-style="{'color': '#ddd'}">{{ouname}}</span>
                            <p>《</p>
                        </div>

                    </div>

                    <div class="login-window col-lg-12" ng-style="{'padding': 0}">
                        <fieldset ng-class="{'opacity': $index}" ng-repeat="rows in entityItem" class="affairs affairs{{$index}}" ng-style="{'background-color': 'rgba(0,0,0,.2)', 'padding-bottom': '30px', 'width': '100%'}">
                            <div ng-if="$index" class="close-event" title="关闭事务" ng-click="closeEvent($index)">
                                <i class="fa fa-close"></i>
                            </div>
                            <div class="title">基础信息</div>

                            <div class="control-group row">
                                <div class="col-md-2">
                                    <label ng-class="{'color-red': rows.name == ''}" class="control-label">事务名称</label>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input ng-class="{'border-red': rows.name == ''}" type="text" ng-model="rows.name" placeholder="请输入事务名称" class="form-control" required/>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row">
                                <div class="col-md-2">
                                    <label class="control-label">事务类型</label>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <select ng-model="rows.type" class="col-md-5" required>
                                            <option value="POLICE">警察事务</option>
                                            <option value="CRIMINAL">罪犯事务</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row">
                                <div class="col-md-2">
                                    <label class="control-label">事务规则</label>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <select ng-model="rows.drule" class="col-md-5" required>
                                            <option value="E">日常</option>
                                            <option value="D">节假日</option>
                                            <option value="W">周</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row" ng-if="rows.drule == 'D'">
                                <div class="col-md-2">
                                    <label class="control-label">请选择执行日期</label>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <button class="btn btn-info" ng-click="showDate()">选择</button>
                                        <input type="text" id="systemTimeLineDateInput" style="height: 0;width: 0;padding: 0;border: 0;" class="form-control" safe-picker p!format="Y-m-d" ng-model="selectTime" ng-change="changeTime(selectTime)"/>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row" ng-if="rows.drule == 'D'" style="margin-bottom: 30px;">
                                <div class="chooseTimeContainer">
                                    <div class="col-md-2" style="padding: 3px;height: 40px;line-height: 40px;" ng-repeat="item in selectList track by $index">
                                        <div class="chooseTimeContainer-box text-center">
                                            <div class="chooseTimeContainer-box-header"><i class="fa fa-times" ng-click="closeTime($index)"></i></div>
                                            {{item}}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row" ng-if="rows.drule == 'W'" style="margin-bottom: 30px;">
                                <div class="col-md-12">
                                    <div class="chooseWeekContainer">
                                        <div class="form-group pull-left" style="margin: 10px;" ng-repeat="week in weekList" ng-click="chooseWeek(week)">
                                            <label style="vertical-align: middle;">{{week.name}}</label>
                                            <input type="checkbox" ng-model="week.checked" ng-click="chooseWeek(week)" style="width:20px;height: 20px;"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group row">
                                <div class="col-md-2">
                                    <div class="text-left">开始时间:</div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="请输入开始时间" safe-picker p!format="H:i" p!datepicker="false" ng-model="rows.starttime"/>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group row">
                                <div class="col-md-2">
                                    <div class="text-left">结束时间:</div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="请输入结束时间" safe-picker p!format="H:i" p!datepicker="false" ng-model="rows.endtime"/>
                                    </div>
                                </div>
                            </div>

                            <div class="title">设备信息</div>

                            <div class="col-md-12">
                                <div class="col-md-12">
                                    <div class="col-md-12">
                                        <div class="col-md-2">方式</div>
                                        <div class="col-md-3">执行设备</div>
                                        <div class="col-md-3">设备参数</div>
                                        <div class="col-md-3">设备动作</div>
                                        <div class="col-md-1"></div>
                                    </div>
                                    <div class="col-md-2"></div>
                                </div>

                                <div class="col-md-12 device-message" ng-repeat="line in rows.submitDevice">
                                    <div class="col-md-12">
                                        <div class="top-bottom">
                                            <div>
                                                <i ng-if="$index" class="fa fa-chevron-up mouseOver" ng-click="shiftLocation('top', $index)"></i>
                                                <i ng-if="!$index" class="fa fa-chevron-up"></i>
                                            </div>
                                            <div>
                                                <i ng-if="$index != rows.submitDevice.length - 1" class="fa fa-chevron-down mouseOver" ng-click="shiftLocation('bottom', $index)"></i>
                                                <i ng-if="!($index != rows.submitDevice.length - 1)" class="fa fa-chevron-down"></i>
                                            </div>
                                        </div>
                                        <div class="col-md-2 form-group">
                                            <select ng-style="{'width': '80px', 'padding': 0}" ng-model="line.way" class="form-control" placeholder="请选择方式">
                                                <option value="Y">自动</option>
                                                <option value="N">手动</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <input ng-class="{'border-top-bottom': $index == temp.index}" ng-model="line.deviceName" class="form-control" ng-click="deviceWindow($index, true)" type="text" placeholder="请选择动作设备"/>
                                        </div>

                                        <div class="col-md-3 form-group device-args" ng-if="line.movementId != 'polling'">
                                            <input ng-style="{'position': 'relative'}"
                                                   type="text"
                                                   ng-model="line.parameter"
                                                   placeholder="请输入设备参数"
                                                   class="form-control input{{$index}}"
                                                   ng-focus="remindArgs($index, 'focus')"
                                                   ng-blur="remindArgs($index, 'blur')"/>
                                            <div class="args{{$index}}">
                                                <div class="col-lg-12"
                                                     ng-repeat="rows in argsList[$index]"
                                                     ng-mousedown="getArgs(line, rows.value)">{{rows.name}}</div>
                                            </div>
                                        </div>

                                        <div class="col-md-3 form-group device-args" ng-if="line.movementId == 'polling'">
                                            <select class="form-control" ng-model="line.parameter" ng-options="action.id as action.name for action in polling[line.deviceId]"></select>
                                        </div>



                                        <div class="col-md-3 form-group">
                                            <select ng-class="{'border-red': line.deviceName != '' && (line.movementId == '' || line.movementId == null)}" class="form-control" ng-model="line.movementId" id="movement" ng-options="rows.actionstr as rows.name for rows in line.movement" placeholder="请选择动作" ng-disabled="rows.deviceName == ''"></select>
                                        </div>
                                        <div class="col-md-1" ng-style="{'padding': '5px 0','position': 'relative'}">
                                            <i class="fa fa-plus-circle faCircle" ng-click="addDevice(null, $index)"></i>
                                            <i class="fa fa-close faCircle delete" ng-click="delDevice($index)"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </form>
            </div>


        </div>
        <div class="ui-layout-container iiw-system-form-button-layout-container text-center" size="60px" ui-layout-container>
            <uib-pagination boundary-links="true" first-text="&laquo;" last-text="&raquo;" class="pagination" total-items="entityItem.length" ng-model="timeLine.showWho" ng-change="shiftAffairs()" items-per-page="1" previous-text="上一页" next-text="下一页" max-size="5"></uib-pagination>
            <div class="text-right">
                <button class="btn btn-success btn-s-md"
                        ng-disabled="entityItemForm.$invalid || ouname == '' || ouname == '请选择单位！'"
                        ng-click="save()">提交</button>
                <button class="btn btn-info btn-s-md"  ng-click="addAffairs()">添加事务</button>
                <button class="btn btn-danger btn-s-md" ng-click="cancel()">取消</button>
            </div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="chooseDevice2.html">
    <div class="modal-header">
        <div class="filter" ng-style="{'height': '50px'}">
            <div class="col-md-4">
                <div class="col-md-3 text-middle">设备类型</div>
                <div class="col-md-8 form-group">
                    <select ng-model="timelineFilter.type" id="deviceType3" ng-options="rows.content as rows.name for rows in device.typeList" ng-change="device.getManufacturerList()">
                        <option value="" selected> 全部类型</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="col-md-3">设备厂商</div>
                <div class="col-md-8 form-group">
                    <select ng-model="timelineFilter.manufacturer" id="manufacturer2" ng-options="rows.id as rows.name for rows in timelineFilter.manufacturerList" ng-change="device.getList()">
                        <option value="" selected> 全部厂商</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="col-md-3">设备类型</div>
                <div class="col-md-8 form-group">
                    <input type="text" ng-model="timelineFilter.filter" placeholder="请输入过滤信息"/>
                </div>
            </div>
        </div>

    </div>
    <div class="modal-body">
        <table class="form-group" ng-style="{'width': '100%'}">
            <col/><col/><col/><col/><col/><col width="100px"/>
            <thead>
            <tr>
                <th>编号</th>
                <th>设备名称</th>
                <th>所属单位</th>
                <th>类型</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-class="{'orange': rows.id == temp.id}" ng-repeat="rows in device.list" ng-click="device.getType(rows)">
                <td>{{rows.code}}</td>
                <td>{{rows.name}}</td>
                <td>{{rows.syouname}}</td>
                <td>{{rows.typename}}</td>
                <td ng-if="rows.status == 'P'" >启用</td>
                <td ng-if="rows.status == 'C'" >禁用</td>
                <td ng-if="rows.status != 'C' && rows.status != 'P'" >未知</td>
                <td><button class="btn btn-success" ng-click="device.choose(rows.id, rows.name, rows.type)">选择</button></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="modal-footer">
        <div class="col-md-12 text-center">
            <uib-pagination boundary-links="true" first-text="&laquo;" last-text="&raquo;" class="pagination" total-items="device.totalSize" ng-model="device.pageNo" ng-change="device.getList()" items-per-page="device.pageSize" previous-text="上一页" next-text="下一页" max-size="5"></uib-pagination>
        </div>

    </div>
</script>
